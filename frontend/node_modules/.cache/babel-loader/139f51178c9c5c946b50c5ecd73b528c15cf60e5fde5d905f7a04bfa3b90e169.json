{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TokenEntryCache = exports.TokenEntry = void 0;\nconst cache_1 = require(\"./cache\");\n/* Default expiration is now for when no expiration provided */\nconst DEFAULT_EXPIRATION_SECS = 0;\n/** @internal */\nclass TokenEntry extends cache_1.ExpiringCacheEntry {\n  /**\r\n   * Instantiate the entry.\r\n   */\n  constructor(tokenResult, serverInfo, expiration) {\n    super(expiration);\n    this.tokenResult = tokenResult;\n    this.serverInfo = serverInfo;\n  }\n}\nexports.TokenEntry = TokenEntry;\n/**\r\n * Cache of OIDC token entries.\r\n * @internal\r\n */\nclass TokenEntryCache extends cache_1.Cache {\n  /**\r\n   * Set an entry in the token cache.\r\n   */\n  addEntry(address, username, callbackHash, tokenResult, serverInfo) {\n    const entry = new TokenEntry(tokenResult, serverInfo, tokenResult.expiresInSeconds ?? DEFAULT_EXPIRATION_SECS);\n    this.entries.set(this.cacheKey(address, username, callbackHash), entry);\n    return entry;\n  }\n  /**\r\n   * Delete an entry from the cache.\r\n   */\n  deleteEntry(address, username, callbackHash) {\n    this.entries.delete(this.cacheKey(address, username, callbackHash));\n  }\n  /**\r\n   * Get an entry from the cache.\r\n   */\n  getEntry(address, username, callbackHash) {\n    return this.entries.get(this.cacheKey(address, username, callbackHash));\n  }\n  /**\r\n   * Delete all expired entries from the cache.\r\n   */\n  deleteExpiredEntries() {\n    for (const [key, entry] of this.entries) {\n      if (!entry.isValid()) {\n        this.entries.delete(key);\n      }\n    }\n  }\n  /**\r\n   * Create a cache key from the address and username.\r\n   */\n  cacheKey(address, username, callbackHash) {\n    return this.hashedCacheKey(address, username, callbackHash);\n  }\n}\nexports.TokenEntryCache = TokenEntryCache;","map":{"version":3,"mappings":";;;;;;AACA;AAEA;AACA,MAAMA,uBAAuB,GAAG,CAAC;AAEjC;AACA,MAAaC,UAAW,SAAQC,0BAAkB;EAIhD;;;EAGAC,YAAYC,WAA8B,EAAEC,UAAyB,EAAEC,UAAkB;IACvF,KAAK,CAACA,UAAU,CAAC;IACjB,IAAI,CAACF,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,UAAU,GAAGA,UAAU;EAC9B;;AAXFE;AAcA;;;;AAIA,MAAaC,eAAgB,SAAQN,aAAiB;EACpD;;;EAGAO,QAAQ,CACNC,OAAe,EACfC,QAAgB,EAChBC,YAAoB,EACpBR,WAA8B,EAC9BC,UAAyB;IAEzB,MAAMQ,KAAK,GAAG,IAAIZ,UAAU,CAC1BG,WAAW,EACXC,UAAU,EACVD,WAAW,CAACU,gBAAgB,IAAId,uBAAuB,CACxD;IACD,IAAI,CAACe,OAAO,CAACC,GAAG,CAAC,IAAI,CAACC,QAAQ,CAACP,OAAO,EAAEC,QAAQ,EAAEC,YAAY,CAAC,EAAEC,KAAK,CAAC;IACvE,OAAOA,KAAK;EACd;EAEA;;;EAGAK,WAAW,CAACR,OAAe,EAAEC,QAAgB,EAAEC,YAAoB;IACjE,IAAI,CAACG,OAAO,CAACI,MAAM,CAAC,IAAI,CAACF,QAAQ,CAACP,OAAO,EAAEC,QAAQ,EAAEC,YAAY,CAAC,CAAC;EACrE;EAEA;;;EAGAQ,QAAQ,CAACV,OAAe,EAAEC,QAAgB,EAAEC,YAAoB;IAC9D,OAAO,IAAI,CAACG,OAAO,CAACM,GAAG,CAAC,IAAI,CAACJ,QAAQ,CAACP,OAAO,EAAEC,QAAQ,EAAEC,YAAY,CAAC,CAAC;EACzE;EAEA;;;EAGAU,oBAAoB;IAClB,KAAK,MAAM,CAACC,GAAG,EAAEV,KAAK,CAAC,IAAI,IAAI,CAACE,OAAO,EAAE;MACvC,IAAI,CAACF,KAAK,CAACW,OAAO,EAAE,EAAE;QACpB,IAAI,CAACT,OAAO,CAACI,MAAM,CAACI,GAAG,CAAC;;;EAG9B;EAEA;;;EAGAN,QAAQ,CAACP,OAAe,EAAEC,QAAgB,EAAEC,YAAoB;IAC9D,OAAO,IAAI,CAACa,cAAc,CAACf,OAAO,EAAEC,QAAQ,EAAEC,YAAY,CAAC;EAC7D;;AAlDFL","names":["DEFAULT_EXPIRATION_SECS","TokenEntry","cache_1","constructor","tokenResult","serverInfo","expiration","exports","TokenEntryCache","addEntry","address","username","callbackHash","entry","expiresInSeconds","entries","set","cacheKey","deleteEntry","delete","getEntry","get","deleteExpiredEntries","key","isValid","hashedCacheKey"],"sources":["C:\\Users\\joelg\\Downloads\\MernStack-Tour-Management-main\\MernStack-Tour-Management-main\\tour-management\\node_modules\\mongodb\\src\\cmap\\auth\\mongodb_oidc\\token_entry_cache.ts"],"sourcesContent":["import type { IdPServerInfo, IdPServerResponse } from '../mongodb_oidc';\r\nimport { Cache, ExpiringCacheEntry } from './cache';\r\n\r\n/* Default expiration is now for when no expiration provided */\r\nconst DEFAULT_EXPIRATION_SECS = 0;\r\n\r\n/** @internal */\r\nexport class TokenEntry extends ExpiringCacheEntry {\r\n  tokenResult: IdPServerResponse;\r\n  serverInfo: IdPServerInfo;\r\n\r\n  /**\r\n   * Instantiate the entry.\r\n   */\r\n  constructor(tokenResult: IdPServerResponse, serverInfo: IdPServerInfo, expiration: number) {\r\n    super(expiration);\r\n    this.tokenResult = tokenResult;\r\n    this.serverInfo = serverInfo;\r\n  }\r\n}\r\n\r\n/**\r\n * Cache of OIDC token entries.\r\n * @internal\r\n */\r\nexport class TokenEntryCache extends Cache<TokenEntry> {\r\n  /**\r\n   * Set an entry in the token cache.\r\n   */\r\n  addEntry(\r\n    address: string,\r\n    username: string,\r\n    callbackHash: string,\r\n    tokenResult: IdPServerResponse,\r\n    serverInfo: IdPServerInfo\r\n  ): TokenEntry {\r\n    const entry = new TokenEntry(\r\n      tokenResult,\r\n      serverInfo,\r\n      tokenResult.expiresInSeconds ?? DEFAULT_EXPIRATION_SECS\r\n    );\r\n    this.entries.set(this.cacheKey(address, username, callbackHash), entry);\r\n    return entry;\r\n  }\r\n\r\n  /**\r\n   * Delete an entry from the cache.\r\n   */\r\n  deleteEntry(address: string, username: string, callbackHash: string): void {\r\n    this.entries.delete(this.cacheKey(address, username, callbackHash));\r\n  }\r\n\r\n  /**\r\n   * Get an entry from the cache.\r\n   */\r\n  getEntry(address: string, username: string, callbackHash: string): TokenEntry | undefined {\r\n    return this.entries.get(this.cacheKey(address, username, callbackHash));\r\n  }\r\n\r\n  /**\r\n   * Delete all expired entries from the cache.\r\n   */\r\n  deleteExpiredEntries(): void {\r\n    for (const [key, entry] of this.entries) {\r\n      if (!entry.isValid()) {\r\n        this.entries.delete(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a cache key from the address and username.\r\n   */\r\n  cacheKey(address: string, username: string, callbackHash: string): string {\r\n    return this.hashedCacheKey(address, username, callbackHash);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}